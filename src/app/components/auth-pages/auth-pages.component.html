<div class="container-fluid bg-light min-vh-100 d-flex align-items-center justify-content-center py-5">
  <div class="card shadow-lg rounded-lg overflow-hidden" style="max-width: 400px; width: 100%;">
    <div class="card-header bg-primary text-white text-center py-3">
      <h3 class="mb-0">
        <ng-container [ngSwitch]="currentPage">
          <ng-container *ngSwitchCase="'login'">Login</ng-container>
          <ng-container *ngSwitchCase="'register'">Register</ng-container>
          <ng-container *ngSwitchCase="'forgot-password'">Forgot Password</ng-container>
          <ng-container *ngSwitchCase="'reset-password'">Reset Password</ng-container>
        </ng-container>
      </h3>
    </div>
    <div class="card-body p-4">
      <!-- Login Form -->
      <form *ngIf="currentPage === 'login'" (ngSubmit)="onSubmit()" #loginForm="ngForm">
        <div class="mb-3">
          <label for="usernameOrEmail" class="form-label">Username or Email</label>
          <input type="text" class="form-control" id="usernameOrEmail" name="usernameOrEmail" [(ngModel)]="usernameOrEmail" required>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <input type="password" class="form-control" id="password" name="password" [(ngModel)]="password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100" [disabled]="loginForm.invalid">Login</button>
      </form>

      <!-- Register Form -->
      <form *ngIf="currentPage === 'register'" (ngSubmit)="onSubmit()" #registerForm="ngForm">
        <div class="mb-3">
          <label for="username" class="form-label">Username</label>
          <input type="text" class="form-control" id="username" name="username" [(ngModel)]="username" required pattern="^[a-zA-Z0-9_]+$" #usernameInput="ngModel">
          <div *ngIf="usernameInput.invalid && (usernameInput.dirty || usernameInput.touched)" class="text-danger small">
            <div *ngIf="usernameInput.errors?.['required']">Username is required.</div>
            <div *ngIf="usernameInput.errors?.['pattern']">Username can only contain letters, numbers, and underscores.</div>
          </div>
        </div>
        <div class="mb-3">
          <label for="name" class="form-label">Name</label>
          <input type="text" class="form-control" id="name" name="name" [(ngModel)]="name" required>
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          <input type="email" class="form-control" id="email" name="email" [(ngModel)]="email" required email #emailInput="ngModel">
          <div *ngIf="emailInput.invalid && (emailInput.dirty || emailInput.touched)" class="text-danger small">
            <div *ngIf="emailInput.errors?.['required']">Email is required.</div>
            <div *ngIf="emailInput.errors?.['email']">Please enter a valid email address.</div>
          </div>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <input type="password" class="form-control" id="password" name="password" [(ngModel)]="password" required>
        </div>
        <div class="mb-3">
          <label for="phoneNumber" class="form-label">Phone Number</label>
          <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" [(ngModel)]="phoneNumber">
        </div>
        <div class="mb-3">
          <label for="age" class="form-label">Age</label>
          <input type="number" class="form-control" id="age" name="age" [(ngModel)]="age" min="0" max="120">
        </div>
        <button type="submit" class="btn btn-primary w-100" [disabled]="registerForm.invalid">Register</button>
      </form>

      <!-- Forgot Password Form -->
      <form *ngIf="currentPage === 'forgot-password'" [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()">
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          <input type="email" class="form-control" id="email" formControlName="email" required>
          <div *ngIf="forgotPasswordForm.get('email')?.invalid && (forgotPasswordForm.get('email')?.dirty || forgotPasswordForm.get('email')?.touched)" class="text-danger small">
            <div *ngIf="forgotPasswordForm.get('email')?.errors?.['required']">Email is required.</div>
            <div *ngIf="forgotPasswordForm.get('email')?.errors?.['email']">Invalid email address.</div>
          </div>
        </div>
        <button type="submit" class="btn btn-primary w-100" [disabled]="forgotPasswordForm.invalid || loading">
          <span *ngIf="!loading">Send Reset PIN</span>
          <span *ngIf="loading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
        </button>
      </form>

      <!-- Reset Password Form -->
      <form *ngIf="currentPage === 'reset-password'" (ngSubmit)="onSubmit()" #resetPasswordForm="ngForm">
        <div class="mb-3">
          <label for="pin" class="form-label">PIN</label>
          <input type="text" class="form-control" id="pin" name="pin" [(ngModel)]="pin" required>
        </div>
        <div class="mb-3">
          <label for="newPassword" class="form-label">New Password</label>
          <input type="password" class="form-control" id="newPassword" name="newPassword" [(ngModel)]="newPassword" required>
        </div>
        <button type="submit" class="btn btn-primary w-100" [disabled]="resetPasswordForm.invalid">Reset Password</button>
      </form>

      <div *ngIf="errorMessage" class="alert alert-danger mt-3">{{ errorMessage }}</div>
      <div *ngIf="successMessage" class="alert alert-success mt-3">{{ successMessage }}</div>
    </div>
    <div class="card-footer bg-light text-center py-3">
      <ng-container [ngSwitch]="currentPage">
        <ng-container *ngSwitchCase="'login'">
          <a [routerLink]="['/forgot-password']" class="text-primary text-decoration-none me-3">Forgot Password?</a>
          <a [routerLink]="['/register']" class="text-primary text-decoration-none">Register</a>
        </ng-container>
        <ng-container *ngSwitchCase="'register'">
          <span>Already have an account? </span>
          <a [routerLink]="['/login']" class="text-primary text-decoration-none">Login</a>
        </ng-container>
        <ng-container *ngSwitchCase="'forgot-password'">
          <a [routerLink]="['/login']" class="text-primary text-decoration-none me-3">Back to Login</a>
          <a [routerLink]="['/register']" class="text-primary text-decoration-none">Register</a>
        </ng-container>
        <ng-container *ngSwitchCase="'reset-password'">
          <a [routerLink]="['/login']" class="text-primary text-decoration-none">Back to Login</a>
        </ng-container>
      </ng-container>
    </div>
  </div>
</div>
